(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(91617)}])},91617:function(e,n,t){"use strict";t.r(n);var r=t(34051),o=t.n(r),i=t(85893),l=t(67294),a=t(9473),u=t(30340),c=t(66383),s=t(95243),f=t(16327),d=t(61690),p=t(87006),v=t(72216),m=t(901),_=t(59390),h=t(38885),g=t(22856),y=t(27941),b=t(23766),w=t(15497),S=t(94640),E=t(27392),A=t(59111),O=t(77715),k=t(47426),N=t(53063),R=t(12671),x=t(87784),I=t(52955);function D(e,n,t,r,o,i,l){try{var a=e[i](l),u=a.value}catch(c){return void t(c)}a.done?n(u):Promise.resolve(u).then(r,o)}function M(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function l(e){D(i,r,o,l,a,"next",e)}function a(e){D(i,r,o,l,a,"throw",e)}l(void 0)}))}}function j(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){j(e,n,t[n])}))}return e}var L={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:k.MW.WAY_BELOW_NORMAL.label}},Z={url:"",filename:""};n.default=(0,s.Z)((function(e){var n=e.user,t=e.onBtnLogoutClick,r=e.loading,s=(0,l.useState)(L),D=s[0],j=s[1],T=(0,l.useState)({}),C=T[0],B=T[1],F=(0,l.useState)([]),W=F[0],Y=F[1],H=(0,l.useState)([]),G=H[0],U=H[1],V=(0,l.useState)([]),K=V[0],X=V[1],$=(0,l.useState)([]),q=$[0],z=$[1],J=(0,b.Z)(D.sel_province,K),Q=(0,S.Z)(D.sel_province,D.sel_municipality),ee=Q.days,ne=Q.loading,te=Q.summary;(0,l.useEffect)((function(){ee.length>0&&B((0,I.Z)(ee,"tenday"))}),[ee]);var re=(0,_.Z)(D.sel_province,D.sel_crop),oe=re.cropcalendar,ie=re.cropStages,le=re.loading,ae=(0,h.Z)().cropList.map((function(e,n){return{disabled:!1,label:e,id:n}})),ue=(0,g.Z)(C.code,q,D.sel_crop,"tenday",!0),ce=ue.recommendations,se=ue.farmoperations,fe=ue.loading,de=(0,y.Z)(D.sel_crop,C.code,"tenday_sms"),pe=de.recommendationsSMS,ve=de.loading,me=(0,w.Z)(ce,ie,q),_e=me.group,he=me.error;(0,l.useEffect)((function(){if(ee.length>0&&!le&&!fe){var e=new Date(ee[0].label_full),n=(0,O.Mn)(e);if(0!==oe.length){var t=oe.data1.find((function(e){return e.municipality===D.sel_municipality&&e.crop===D.sel_crop})),r=oe.data2.find((function(e){return e.municipality===D.sel_municipality&&e.crop===D.sel_crop})),o=[];if(t&&r&&Object.keys(ie).length>0){Object.keys(n).forEach((function(e){var i=t[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==i[0]?o.includes(i[0])||o.push(i[0]):"2nd_half"===e&&"none"!==i[1]&&(o.includes(i[1])||o.push(i[1]))}));var l=r[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==l[0]?o.includes(l[0])||o.push(l[0]):"2nd_half"===e&&"none"!==l[1]&&(o.includes(l[1])||o.push(l[1]))}))}));var i=o.map((function(e,n){return{id:n,label:ie[e].label,code:e}}));z(i)}}}}),[ie,oe.length,oe.data1,oe.data2,ee,D.sel_municipality,D.sel_crop,le,fe]);var ge=(0,a.v9)((function(e){return e.reports})),ye=ge.status,be=ge.report,we=(0,a.v9)((function(e){return e.dashboard.reportType})),Se=(0,a.v9)((function(e){return e.dashboard.isEnglish})),Ee=(0,l.useState)(!0),Ae=Ee[0],Oe=Ee[1],ke=(0,l.useState)(!1),Ne=ke[0],Re=ke[1],xe=(0,l.useRef)(!1),Ie=(0,l.useState)(""),De=Ie[0],Me=Ie[1],je=(0,l.useState)(Z),Pe=je[0],Le=je[1],Ze=(0,l.useState)(E.BF),Te=Ze[0],Ce=Ze[1],Be=(0,a.I0)();(0,l.useEffect)((function(){xe.current=!0;var e=function(){var e=M(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.$m)();case 3:n=e.sent,xe&&X(n.data),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){xe.current=!1}}),[]),(0,l.useEffect)((function(){Be((0,v.Km)([])),Be((0,R.s_)())}),[Be]),(0,l.useEffect)((function(){K.length>0&&U((0,A.m)(K))}),[K]),(0,l.useEffect)((function(){null!==te&&j((function(e){return P({},e,{sel_month:{label:te.date_range}})}))}),[te]),(0,l.useEffect)((function(){Oe(r||fe||le||ne||ve)}),[r,fe,le,ne,ve]),(0,l.useEffect)((function(){Le(Z)}),[Se]),(0,l.useEffect)((function(){0!==pe.length&&Me(pe[0].sms.replace("{{10_day_range_identifier}}",D.sel_month.label))}),[pe,D.sel_month]),(0,l.useEffect)((function(){ye===m.G.FULLFILLED&&null!==be&&xe.current&&Ce((function(e){return P({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:be.id})}))}),[ye,be]),(0,l.useEffect)((function(){he||null===_e||Be((0,v.Km)(_e))}),[_e,he,Be]);var Fe=function(){var e=M(o().mark((function e(){var n,t,r,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Pe.url){e.next=3;break}return Re(!0),e.abrupt("return");case 3:return j((function(e){return P({},e,{loading:!0,error:"",success:""})})),e.prev=4,n={region:"bicol",province:D.sel_province,municipality:D.sel_municipality,operation:"preview",language:Se?"en":"tag",crop:null===D||void 0===D?void 0:D.sel_crop},Re(!0),j((function(e){return P({},e,{loading:!0,error:""})})),e.next=10,(0,p.bM)(n);case 10:t=e.sent,r=new Blob([t],{type:"application/pdf"}),(i={}).href=URL.createObjectURL(r),i.download="".concat(D.sel_province,"_").concat(D.sel_municipality,".pdf"),Le((function(e){return P({},e,{url:i.href,filename:i.download})})),j((function(e){return P({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),e.next=23,(0,x.fu)(e.t0);case 23:l=e.sent,j((function(e){return P({},e,{loading:!1,error:l})}));case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(){return e.apply(this,arguments)}}(),We=function(){var e=M(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ce(P({},Te,{loading:!0,msg:"Saving report..."}));try{t={region:"bicol",province:D.sel_province,municipality:D.sel_municipality,operation:"create",language:Se?"en":"tag",crop:D.sel_crop},Be((0,d.a0)(t)).unwrap().then((function(){we!==E.Ry.TEN_DAY&&(Be((0,N.uq)(E.Ry.TEN_DAY)),Be((0,d.RC)({uid:n.uid,type:E.Ry.TEN_DAY})))})).catch((function(e){xe.current&&Ce((function(n){return P({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(i){r="",void 0!==i.response&&(r=void 0!==i.response.data&&"[object Blob]"===((o=i.response.data)&&"undefined"!==typeof Symbol&&o.constructor===Symbol?"symbol":typeof o)?i.response.data:""),""===r&&(r=i.message),j((function(e){return P({},e,{loading:!1,error:r})}))}case 2:case"end":return e.stop()}var o}),e)})));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(c.Z,{loading:r,user:n,onBtnLogoutClick:t,accLevel:k.DW.ADMIN,children:(0,i.jsx)(u.Z,{climateRisk:C.label,optsprovinces:G,optsmunicipalities:J,optscrops:ae,optscropstages:q,optsactivities:se,sel_options:D,loading:Ae,recommendationsData:ce,isloadingreport:ye===m.G.PENDING,isdisabled:!1,open:Ne,message:Te,smstext:De,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:Pe,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(Le(Z),W.length>0&&Y([]),""!==D.error&&j((function(e){return P({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":z([]),j((function(e){return P({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":z([]),j((function(e){return P({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"crop":j((function(e){return P({},e,{sel_crop:r,sel_stage:null,sel_activity:null})})),z([])}else if("province"===t){var o=D.sel_month;j(P({},L,{sel_month:o})),z([])}else"municipality"===t&&(j(P({},D,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),z([]))},handlePreview:Fe,handleSave:We,toggleViewerOpen:function(){Re((function(e){return!e}))},resetSelections:function(){var e=D.sel_month;j(P({},L,{sel_month:e})),z([]),Be((0,v.Km)([]))},togglePrompt:function(){Ce((function(e){return P({},E.BF,{isOpen:!e.isOpen})}))}})})}))},27941:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var r=t(34051),o=t.n(r),i=t(67294),l=t(17892);function a(e,n,t,r,o,i,l){try{var a=e[i](l),u=a.value}catch(c){return void t(c)}a.done?n(u):Promise.resolve(u).then(r,o)}function u(e,n,t){var r=(0,i.useState)([]),u=r[0],c=r[1],s=(0,i.useState)(!1),f=s[0],d=s[1],p=(0,i.useState)(""),v=p[0],m=p[1];return(0,i.useEffect)((function(){var r=function(){var r,i=(r=o().mark((function r(){var i,a,u,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=[],d(!1),m(""),r.next=6,(0,l.iR)({crop:e,climateRisk:n,type:t});case 6:i=r.sent,d(!1),c(i||[]),r.next=18;break;case 11:r.prev=11,r.t0=r.catch(0),s=null!==(u=null===r.t0||void 0===r.t0||null===(a=r.t0.response)||void 0===a?void 0:a.data)&&void 0!==u?u:r.t0.message,m(s),d(!1);case 18:case"end":return r.stop()}}),r,null,[[0,11]])})),function(){var e=this,n=arguments;return new Promise((function(t,o){var i=r.apply(e,n);function l(e){a(i,t,o,l,u,"next",e)}function u(e){a(i,t,o,l,u,"throw",e)}l(void 0)}))});return function(){return i.apply(this,arguments)}}();e&&t?r():c([])}),[e,n,t]),{recommendationsSMS:u,loading:f,error:v}}},59111:function(e,n,t){"use strict";t.d(n,{m:function(){return r}});var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((function(e,t){return{id:t,label:e[n]}}))}},52955:function(e,n){"use strict";function t(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function r(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){if(0===e.length)return{};for(var n={wb_normal:[],b_normal:[],above_normal:[],near_normal:[]},t=e[0].con,o=1,i=1;i<e.length;i++)e[i].con===t?o++:(n[t].push(o),t=e[i].con,o=1);return n[t].push(o),function(e){var n,t,o,i,l,a,u=(null!==(i=null===e||void 0===e?void 0:e.b_normal.length)&&void 0!==i?i:0)>0?(n=Math).max.apply(n,r(e.b_normal)):void 0,c=(null!==(l=null===e||void 0===e?void 0:e.wb_normal.length)&&void 0!==l?l:0)>0?(t=Math).max.apply(t,r(e.wb_normal)):void 0,s=(null!==(a=null===e||void 0===e?void 0:e.above_normal.length)&&void 0!==a?a:0)>0?(o=Math).max.apply(o,r(e.above_normal)):void 0,f=void 0!==u&&5===u||void 0!==c&&3===c,d=void 0!==u&&u[0]>=3||void 0!==c&&2===c[0];return f?{label:"Drought",code:"drought"}:d?{label:"Dry Spell",code:"dry_spell"}:void 0!==u&&2===u?{label:"Dry Condition",code:"dry_condition"}:void 0!==s&&s>=3?{label:"Wetter Condition",code:"wetter condition"}:{label:"No Risk",code:"no_risk"}}(n)}function i(e){if(0===e.length)return{};for(var n={"NO RAIN":[],"MODERATE RAINS":[],"HEAVY RAINS":[],"LIGHT RAINS":[]},t=e[0].rainfall,o=1,i=1;i<e.length;i++)e[i].rainfall===t?o++:(n[t].push(o),t=e[i].rainfall,o=1);return n[t].push(o),function(e){var n,t,o,i,l,a,u,c,s=(null!==(a=null===(i=e["MODERATE RAINS"])||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0?(n=Math).max.apply(n,r(e["MODERATE RAINS"])):void 0,f=(null!==(u=null===(l=e["HEAVY RAINS"])||void 0===l?void 0:l.length)&&void 0!==u?u:0)>0?(t=Math).max.apply(t,r(e["HEAVY RAINS"])):void 0,d=(null!==(c=e["NO RAIN"].length)&&void 0!==c?c:0)>0?(o=Math).max.apply(o,r(e["NO RAIN"])):void 0;return void 0!==s&&s>=3?{label:"Flooding/Submergence 3M",code:"flooding_submergence_3M"}:void 0!==f&&f>=2?{label:"Flooding/Submergence 2H",code:"flooding_submergence_2H"}:void 0!==d&&10===d?{label:"Dry Condition",code:"dry_condition"}:{label:"No Risk",code:"no_risk"}}(n)}n.Z=function(e,n){switch(n){case"seasonal":return o(e);case"tenday":return i(e)}}}},function(e){e.O(0,[5778,9564,9964,9522,1903,6279,542,7944,6295,1433,6572,1050,3260,3204,3622,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);