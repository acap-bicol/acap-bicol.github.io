(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(91617)}])},91617:function(e,n,t){"use strict";t.r(n);var r=t(34051),i=t.n(r),o=t(85893),u=t(67294),a=t(9473),c=t(30340),l=t(66383),s=t(95243),f=t(16327),p=t(61690),d=t(87006),v=t(24530),m=t(901),_=t(59390),y=t(38885),g=t(22856),h=t(27941),b=t(23766),w=t(15497),S=t(94640),E=t(27392),k=t(59111),O=t(77715),x=t(47426),j=t(53063),A=t(12671),P=t(87784),D=t(52955);function Z(e,n,t,r,i,o,u){try{var a=e[o](u),c=a.value}catch(l){return void t(l)}a.done?n(c):Promise.resolve(c).then(r,i)}function L(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function u(e){Z(o,r,i,u,a,"next",e)}function a(e){Z(o,r,i,u,a,"throw",e)}u(void 0)}))}}function N(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){N(e,n,t[n])}))}return e}var B={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:x.MW.WAY_BELOW_NORMAL.label}},I={url:"",filename:""};n.default=(0,s.Z)((function(e){var n=e.user,t=e.onBtnLogoutClick,r=e.loading,s=(0,u.useState)(B),Z=s[0],N=s[1],C=(0,u.useState)({}),M=C[0],T=C[1],F=(0,u.useState)([]),W=F[0],U=F[1],Y=(0,u.useState)([]),G=Y[0],K=Y[1],X=(0,u.useState)([]),$=X[0],q=X[1],z=(0,u.useState)([]),V=z[0],H=z[1],J=(0,b.Z)(Z.sel_province,$),Q=(0,S.Z)(Z.sel_province,Z.sel_municipality),ee=Q.days,ne=Q.loading,te=Q.summary;(0,u.useEffect)((function(){ee.length>0&&T((0,D.Z)(ee,"tenday"))}),[ee]);var re=(0,_.Z)(Z.sel_province,Z.sel_crop),ie=re.cropcalendar,oe=re.cropStages,ue=re.loading,ae=(0,y.Z)().cropList.map((function(e,n){return{disabled:!1,label:e,id:n}})),ce=(0,g.Z)(M.code,V,Z.sel_crop,"tenday",!0),le=ce.recommendations,se=ce.farmoperations,fe=ce.loading,pe=(0,h.Z)(Z.sel_crop,M.code,"tenday_sms"),de=pe.recommendationsSMS,ve=pe.loading,me=(0,w.Z)(le,oe,V),_e=me.group,ye=me.error;(0,u.useEffect)((function(){if(ee.length>0&&!ue&&!fe){var e=new Date(ee[0].label_full),n=(0,O.Mn)(e);if(0!==ie.length){var t=ie.data1.find((function(e){return e.municipality===Z.sel_municipality&&e.crop===Z.sel_crop})),r=ie.data2.find((function(e){return e.municipality===Z.sel_municipality&&e.crop===Z.sel_crop})),i=[];if(t&&r&&Object.keys(oe).length>0){Object.keys(n).forEach((function(e){var o=t[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==o[0]?i.includes(o[0])||i.push(o[0]):"2nd_half"===e&&"none"!==o[1]&&(i.includes(o[1])||i.push(o[1]))}));var u=r[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==u[0]?i.includes(u[0])||i.push(u[0]):"2nd_half"===e&&"none"!==u[1]&&(i.includes(u[1])||i.push(u[1]))}))}));var o=i.map((function(e,n){return{id:n,label:oe[e].label,code:e}}));H(o)}}}}),[oe,ie.length,ie.data1,ie.data2,ee,Z.sel_municipality,Z.sel_crop,ue,fe]);var ge=(0,a.v9)((function(e){return e.reports})),he=ge.status,be=ge.report,we=(0,a.v9)((function(e){return e.dashboard.reportType})),Se=(0,a.v9)((function(e){return e.dashboard.isEnglish})),Ee=(0,u.useState)(!0),ke=Ee[0],Oe=Ee[1],xe=(0,u.useState)(!1),je=xe[0],Ae=xe[1],Pe=(0,u.useRef)(!1),De=(0,u.useState)(""),Ze=De[0],Le=De[1],Ne=(0,u.useState)(I),Re=Ne[0],Be=Ne[1],Ie=(0,u.useState)(E.BF),Ce=Ie[0],Me=Ie[1],Te=(0,a.I0)();(0,u.useEffect)((function(){Pe.current=!0;var e=function(){var e=L(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.$m)();case 3:n=e.sent,Pe&&q(n.data),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){Pe.current=!1}}),[]),(0,u.useEffect)((function(){Te((0,v.Km)([])),Te((0,A.s_)())}),[Te]),(0,u.useEffect)((function(){$.length>0&&K((0,k.m)($))}),[$]),(0,u.useEffect)((function(){null!==te&&N((function(e){return R({},e,{sel_month:{label:te.date_range}})}))}),[te]),(0,u.useEffect)((function(){Oe(r||fe||ue||ne||ve)}),[r,fe,ue,ne,ve]),(0,u.useEffect)((function(){Be(I)}),[Se]),(0,u.useEffect)((function(){0!==de.length&&Le(de[0].sms.replace("{{10_day_range_identifier}}",Z.sel_month.label))}),[de,Z.sel_month]),(0,u.useEffect)((function(){he===m.G.FULLFILLED&&null!==be&&Pe.current&&Me((function(e){return R({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:be.id})}))}),[he,be]),(0,u.useEffect)((function(){ye||null===_e||Te((0,v.Km)(_e))}),[_e,ye,Te]);var Fe=function(){var e=L(i().mark((function e(){var n,t,r,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Re.url){e.next=3;break}return Ae(!0),e.abrupt("return");case 3:return N((function(e){return R({},e,{loading:!0,error:"",success:""})})),e.prev=4,n={region:"bicol",province:Z.sel_province,municipality:Z.sel_municipality,operation:"preview",language:Se?"en":"tag",crop:"Rice"},Ae(!0),N((function(e){return R({},e,{loading:!0,error:""})})),e.next=10,(0,d.bM)(n);case 10:t=e.sent,r=new Blob([t],{type:"application/pdf"}),(o={}).href=URL.createObjectURL(r),o.download="".concat(Z.sel_province,"_").concat(Z.sel_municipality,".pdf"),Be((function(e){return R({},e,{url:o.href,filename:o.download})})),N((function(e){return R({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),e.next=23,(0,P.fu)(e.t0);case 23:u=e.sent,N((function(e){return R({},e,{loading:!1,error:u})}));case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(){return e.apply(this,arguments)}}(),We=function(){var e=L(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Me(R({},Ce,{loading:!0,msg:"Saving report..."}));try{t={region:"bicol",province:Z.sel_province,municipality:Z.sel_municipality,operation:"create",language:Se?"en":"tag",crop:Z.sel_crop},Te((0,p.a0)(t)).unwrap().then((function(){we!==E.Ry.TEN_DAY&&(Te((0,j.uq)(E.Ry.TEN_DAY)),Te((0,p.RC)({uid:n.uid,type:E.Ry.TEN_DAY})))})).catch((function(e){Pe.current&&Me((function(n){return R({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(o){r="",void 0!==o.response&&(r=void 0!==o.response.data&&"[object Blob]"===((i=o.response.data)&&"undefined"!==typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)?o.response.data:""),""===r&&(r=o.message),N((function(e){return R({},e,{loading:!1,error:r})}))}case 2:case"end":return e.stop()}var i}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.jsx)(l.Z,{loading:r,user:n,onBtnLogoutClick:t,accLevel:x.DW.ADMIN,children:(0,o.jsx)(c.Z,{climateRisk:M.label,optsprovinces:G,optsmunicipalities:J,optscrops:ae,optscropstages:V,optsactivities:se,sel_options:Z,loading:ke,recommendationsData:le,isloadingreport:he===m.G.PENDING,isdisabled:!1,open:je,message:Ce,smstext:Ze,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:Re,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(Be(I),W.length>0&&U([]),""!==Z.error&&N((function(e){return R({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":H([]),N((function(e){return R({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":H([]),N((function(e){return R({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"crop":N((function(e){return R({},e,{sel_crop:r,sel_stage:null,sel_activity:null})})),H([])}else if("province"===t){var i=Z.sel_month;N(R({},B,{sel_month:i})),H([])}else"municipality"===t&&(N(R({},Z,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),H([]))},handlePreview:Fe,handleSave:We,toggleViewerOpen:function(){Ae((function(e){return!e}))},resetSelections:function(){var e=Z.sel_month;N(R({},B,{sel_month:e})),H([]),Te((0,v.Km)([]))},togglePrompt:function(){Me((function(e){return R({},E.BF,{isOpen:!e.isOpen})}))}})})}))},15497:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var r=t(67294);function i(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return i(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,n,t){var i=(0,r.useState)(null),u=i[0],a=i[1],c=(0,r.useState)(""),l=c[0],s=c[1];return(0,r.useEffect)((function(){if(s(""),(null===e||void 0===e?void 0:e.length)>0&&(null===t||void 0===t?void 0:t.length)>0){var r=e.map((function(e){return e.farming_activity})).filter((function(e,n,t){return t.indexOf(e)===n})),i=null===t||void 0===t?void 0:t.map((function(e){return e.code}));try{a(i.reduce((function(t,i){return r.forEach((function(r){var u=n[i].label,a=e.filter((function(e){return e.crop_stage===i&&e.farming_activity===r}));a.length>0&&u&&(void 0===t[u]&&(t[u]={}),void 0===t[u][r]&&(t[u][r]=[]),t[u][r]=o(t[u][r]).concat(o(a)))})),t}),{}))}catch(u){a(null),s(u)}}else a(null)}),[e,n,t]),{group:u,error:l}}},27941:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(34051),i=t.n(r),o=t(67294),u=t(1096);function a(e,n,t,r,i,o,u){try{var a=e[o](u),c=a.value}catch(l){return void t(l)}a.done?n(c):Promise.resolve(c).then(r,i)}function c(e,n,t){var r=(0,o.useState)([]),c=r[0],l=r[1],s=(0,o.useState)(!1),f=s[0],p=s[1],d=(0,o.useState)(""),v=d[0],m=d[1];return(0,o.useEffect)((function(){var r=function(){var r,o=(r=i().mark((function r(){var o,a,c,s;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o=[],p(!1),m(""),r.next=6,(0,u.iR)({crop:e,climateRisk:n,type:t});case 6:o=r.sent,p(!1),l(o||[]),r.next=18;break;case 11:r.prev=11,r.t0=r.catch(0),s=null!==(c=null===r.t0||void 0===r.t0||null===(a=r.t0.response)||void 0===a?void 0:a.data)&&void 0!==c?c:r.t0.message,m(s),p(!1);case 18:case"end":return r.stop()}}),r,null,[[0,11]])})),function(){var e=this,n=arguments;return new Promise((function(t,i){var o=r.apply(e,n);function u(e){a(o,t,i,u,c,"next",e)}function c(e){a(o,t,i,u,c,"throw",e)}u(void 0)}))});return function(){return o.apply(this,arguments)}}();e&&t?r():l([])}),[e,n,t]),{recommendationsSMS:c,loading:f,error:v}}}},function(e){e.O(0,[5778,9564,9964,9522,1903,6279,542,7944,6295,1433,6572,1050,3797,9385,3622,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);