(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(91617)}])},91617:function(e,n,t){"use strict";t.r(n);var r=t(34051),o=t.n(r),i=t(85893),l=t(67294),a=t(9473),u=t(30340),c=t(66383),s=t(95243),d=t(16327),f=t(61690),p=t(87006),v=t(72216),m=t(901),_=t(59390),g=t(38885),h=t(22856),y=t(27941),b=t(23766),S=t(15497),w=t(94640),E=t(27392),A=t(59111),O=t(77715),k=t(47426),N=t(53063),R=t(12671),x=t(87784),I=t(52955);function D(e,n,t,r,o,i,l){try{var a=e[i](l),u=a.value}catch(c){return void t(c)}a.done?n(u):Promise.resolve(u).then(r,o)}function M(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function l(e){D(i,r,o,l,a,"next",e)}function a(e){D(i,r,o,l,a,"throw",e)}l(void 0)}))}}function j(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){j(e,n,t[n])}))}return e}var L={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:k.MW.WAY_BELOW_NORMAL.label}},Z={url:"",filename:""};n.default=(0,s.Z)((function(e){var n=e.user,t=e.onBtnLogoutClick,r=e.loading,s=(0,l.useState)(L),D=s[0],j=s[1],F=(0,l.useState)({}),T=F[0],C=F[1],B=(0,l.useState)({}),H=B[0],W=B[1],Y=(0,l.useState)([]),G=Y[0],U=Y[1],V=(0,l.useState)([]),K=V[0],X=V[1],$=(0,l.useState)([]),q=$[0],z=$[1],J=(0,l.useState)([]),Q=J[0],ee=J[1],ne=(0,b.Z)(D.sel_province,q),te=(0,w.Z)(D.sel_province,D.sel_municipality),re=te.days,oe=te.loading,ie=te.summary;(0,l.useEffect)((function(){if(re.length>0){var e=(0,I.Z)(re,"tenday"),n=P({},e);["Flooding/Submergence 3M","Flooding/Submergence 2H"].includes(n.label)&&(e.label="Flooding/Submergence",e.code="flood_submergence"),C(e),W(n)}}),[re]);var le=(0,_.Z)(D.sel_province,D.sel_crop),ae=le.cropcalendar,ue=le.cropStages,ce=le.loading,se=(0,g.Z)().cropList.map((function(e,n){return{disabled:!1,label:e,id:n}})),de=(0,h.Z)(T.code,Q,D.sel_crop,"tenday",!0),fe=de.recommendations,pe=de.farmoperations,ve=de.loading,me=(0,y.Z)(D.sel_crop,H.code,"tenday_sms"),_e=me.recommendationsSMS,ge=me.loading,he=(0,S.Z)(fe,ue,Q),ye=he.group,be=he.error;(0,l.useEffect)((function(){if(re.length>0&&!ce&&!ve){var e=new Date(re[0].label_full),n=(0,O.Mn)(e);if(0!==ae.length){var t=ae.data1.find((function(e){return e.municipality===D.sel_municipality&&e.crop===D.sel_crop})),r=ae.data2.find((function(e){return e.municipality===D.sel_municipality&&e.crop===D.sel_crop})),o=[];if(t&&r&&Object.keys(ue).length>0){Object.keys(n).forEach((function(e){var i=t[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==i[0]?o.includes(i[0])||o.push(i[0]):"2nd_half"===e&&"none"!==i[1]&&(o.includes(i[1])||o.push(i[1]))}));var l=r[e].split(",");n[e].forEach((function(e){"1st_half"===e&&"none"!==l[0]?o.includes(l[0])||o.push(l[0]):"2nd_half"===e&&"none"!==l[1]&&(o.includes(l[1])||o.push(l[1]))}))}));var i=o.map((function(e,n){return{id:n,label:ue[e].label,code:e}}));ee(i)}}}}),[ue,ae.length,ae.data1,ae.data2,re,D.sel_municipality,D.sel_crop,ce,ve]);var Se=(0,a.v9)((function(e){return e.reports})),we=Se.status,Ee=Se.report,Ae=(0,a.v9)((function(e){return e.dashboard.reportType})),Oe=(0,a.v9)((function(e){return e.dashboard.isEnglish})),ke=(0,l.useState)(!0),Ne=ke[0],Re=ke[1],xe=(0,l.useState)(!1),Ie=xe[0],De=xe[1],Me=(0,l.useRef)(!1),je=(0,l.useState)(""),Pe=je[0],Le=je[1],Ze=(0,l.useState)(Z),Fe=Ze[0],Te=Ze[1],Ce=(0,l.useState)(E.BF),Be=Ce[0],He=Ce[1],We=(0,a.I0)();(0,l.useEffect)((function(){Me.current=!0;var e=function(){var e=M(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,d.$m)();case 3:n=e.sent,Me&&z(n.data),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){Me.current=!1}}),[]),(0,l.useEffect)((function(){We((0,v.Km)([])),We((0,R.s_)())}),[We]),(0,l.useEffect)((function(){q.length>0&&X((0,A.m)(q))}),[q]),(0,l.useEffect)((function(){null!==ie&&j((function(e){return P({},e,{sel_month:{label:ie.date_range}})}))}),[ie]),(0,l.useEffect)((function(){Re(r||ve||ce||oe||ge)}),[r,ve,ce,oe,ge]),(0,l.useEffect)((function(){Te(Z)}),[Oe]),(0,l.useEffect)((function(){0!==_e.length&&Le(_e[0].sms.replace("{{10_day_range_identifier}}",D.sel_month.label))}),[_e,D.sel_month]),(0,l.useEffect)((function(){we===m.G.FULLFILLED&&null!==Ee&&Me.current&&He((function(e){return P({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:Ee.id})}))}),[we,Ee]),(0,l.useEffect)((function(){be||null===ye||We((0,v.Km)(ye))}),[ye,be,We]);var Ye=function(){var e=M(o().mark((function e(){var n,t,r,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Fe.url){e.next=3;break}return De(!0),e.abrupt("return");case 3:return j((function(e){return P({},e,{loading:!0,error:"",success:""})})),e.prev=4,n={region:"bicol",province:D.sel_province,municipality:D.sel_municipality,operation:"preview",language:Oe?"en":"tag",crop:null===D||void 0===D?void 0:D.sel_crop},De(!0),j((function(e){return P({},e,{loading:!0,error:""})})),e.next=10,(0,p.bM)(n);case 10:t=e.sent,r=new Blob([t],{type:"application/pdf"}),(i={}).href=URL.createObjectURL(r),i.download="".concat(D.sel_province,"_").concat(D.sel_municipality,".pdf"),Te((function(e){return P({},e,{url:i.href,filename:i.download})})),j((function(e){return P({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),e.next=23,(0,x.fu)(e.t0);case 23:l=e.sent,j((function(e){return P({},e,{loading:!1,error:l})}));case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(){return e.apply(this,arguments)}}(),Ge=function(){var e=M(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:He(P({},Be,{loading:!0,msg:"Saving report..."}));try{t={region:"bicol",province:D.sel_province,municipality:D.sel_municipality,operation:"create",language:Oe?"en":"tag",crop:D.sel_crop},We((0,f.a0)(t)).unwrap().then((function(){Ae!==E.Ry.TEN_DAY&&(We((0,N.uq)(E.Ry.TEN_DAY)),We((0,f.RC)({uid:n.uid,type:E.Ry.TEN_DAY})))})).catch((function(e){Me.current&&He((function(n){return P({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(i){r="",void 0!==i.response&&(r=void 0!==i.response.data&&"[object Blob]"===((o=i.response.data)&&"undefined"!==typeof Symbol&&o.constructor===Symbol?"symbol":typeof o)?i.response.data:""),""===r&&(r=i.message),j((function(e){return P({},e,{loading:!1,error:r})}))}case 2:case"end":return e.stop()}var o}),e)})));return function(){return e.apply(this,arguments)}}();return(0,i.jsx)(c.Z,{loading:r,user:n,onBtnLogoutClick:t,accLevel:k.DW.ADMIN,children:(0,i.jsx)(u.Z,{climateRisk:T.label,optsprovinces:K,optsmunicipalities:ne,optscrops:se,optscropstages:Q,optsactivities:pe,sel_options:D,loading:Ne,recommendationsData:fe,isloadingreport:we===m.G.PENDING,isdisabled:!1,open:Ie,message:Be,smstext:Pe,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:Fe,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(Te(Z),G.length>0&&U([]),""!==D.error&&j((function(e){return P({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":ee([]),j((function(e){return P({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":ee([]),j((function(e){return P({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"crop":j((function(e){return P({},e,{sel_crop:r,sel_stage:null,sel_activity:null})})),ee([])}else if("province"===t){var o=D.sel_month;j(P({},L,{sel_month:o})),ee([])}else"municipality"===t&&(j(P({},D,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),ee([]))},handlePreview:Ye,handleSave:Ge,toggleViewerOpen:function(){De((function(e){return!e}))},resetSelections:function(){var e=D.sel_month;j(P({},L,{sel_month:e})),ee([]),We((0,v.Km)([]))},togglePrompt:function(){He((function(e){return P({},E.BF,{isOpen:!e.isOpen})}))}})})}))},27941:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var r=t(34051),o=t.n(r),i=t(67294),l=t(17892);function a(e,n,t,r,o,i,l){try{var a=e[i](l),u=a.value}catch(c){return void t(c)}a.done?n(u):Promise.resolve(u).then(r,o)}function u(e,n,t){var r=(0,i.useState)([]),u=r[0],c=r[1],s=(0,i.useState)(!1),d=s[0],f=s[1],p=(0,i.useState)(""),v=p[0],m=p[1];return(0,i.useEffect)((function(){var r=function(){var r,i=(r=o().mark((function r(){var i,a,u,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=[],f(!1),m(""),r.next=6,(0,l.iR)({crop:e,climateRisk:n,type:t});case 6:i=r.sent,f(!1),c(i||[]),r.next=18;break;case 11:r.prev=11,r.t0=r.catch(0),s=null!==(u=null===r.t0||void 0===r.t0||null===(a=r.t0.response)||void 0===a?void 0:a.data)&&void 0!==u?u:r.t0.message,m(s),f(!1);case 18:case"end":return r.stop()}}),r,null,[[0,11]])})),function(){var e=this,n=arguments;return new Promise((function(t,o){var i=r.apply(e,n);function l(e){a(i,t,o,l,u,"next",e)}function u(e){a(i,t,o,l,u,"throw",e)}l(void 0)}))});return function(){return i.apply(this,arguments)}}();e&&t?r():c([])}),[e,n,t]),{recommendationsSMS:u,loading:d,error:v}}},59111:function(e,n,t){"use strict";t.d(n,{m:function(){return r}});var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((function(e,t){return{id:t,label:e[n]}}))}},52955:function(e,n){"use strict";function t(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function r(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){if(0===e.length)return{};for(var n={wb_normal:[],b_normal:[],above_normal:[],near_normal:[]},t=e[0].con,o=1,i=1;i<e.length;i++)e[i].con===t?o++:(n[t].push(o),t=e[i].con,o=1);return n[t].push(o),function(e){var n,t,o,i,l,a,u=(null!==(i=null===e||void 0===e?void 0:e.b_normal.length)&&void 0!==i?i:0)>0?(n=Math).max.apply(n,r(e.b_normal)):void 0,c=(null!==(l=null===e||void 0===e?void 0:e.wb_normal.length)&&void 0!==l?l:0)>0?(t=Math).max.apply(t,r(e.wb_normal)):void 0,s=(null!==(a=null===e||void 0===e?void 0:e.above_normal.length)&&void 0!==a?a:0)>0?(o=Math).max.apply(o,r(e.above_normal)):void 0,d=void 0!==u&&5===u||void 0!==c&&3===c,f=void 0!==u&&u[0]>=3||void 0!==c&&2===c[0];return d?{label:"Drought",code:"drought"}:f?{label:"Dry Spell",code:"dry_spell"}:void 0!==u&&2===u?{label:"Dry Condition",code:"dry_condition"}:void 0!==s&&s>=3?{label:"Wetter Condition",code:"wetter condition"}:{label:"No Risk",code:"no_risk"}}(n)}function i(e){if(0===e.length)return{};for(var n={"NO RAIN":[],"MODERATE RAINS":[],"HEAVY RAINS":[],"LIGHT RAINS":[]},t=e[0].rainfall,o=1,i=1;i<e.length;i++)e[i].rainfall===t?o++:(n[t].push(o),t=e[i].rainfall,o=1);return n[t].push(o),function(e){var n,t,o,i,l,a,u,c,s=(null!==(a=null===(i=e["MODERATE RAINS"])||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0?(n=Math).max.apply(n,r(e["MODERATE RAINS"])):void 0,d=(null!==(u=null===(l=e["HEAVY RAINS"])||void 0===l?void 0:l.length)&&void 0!==u?u:0)>0?(t=Math).max.apply(t,r(e["HEAVY RAINS"])):void 0,f=(null!==(c=e["NO RAIN"].length)&&void 0!==c?c:0)>0?(o=Math).max.apply(o,r(e["NO RAIN"])):void 0;return void 0!==s&&s>=3?{label:"Flooding/Submergence 3M",code:"flooding_submergence_3M"}:void 0!==d&&d>=2?{label:"Flooding/Submergence 2H",code:"flooding_submergence_2H"}:void 0!==f&&10===f?{label:"Dry Condition",code:"dry_condition"}:{label:"No Risk",code:"no_risk"}}(n)}n.Z=function(e,n){switch(n){case"seasonal":return o(e);case"tenday":return i(e)}}}},function(e){e.O(0,[5778,9564,9964,9522,1903,6279,542,7944,6295,1433,6572,1050,3260,3204,3622,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);